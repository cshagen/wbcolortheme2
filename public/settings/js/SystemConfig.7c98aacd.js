"use strict";(self["webpackChunkopenwb_ui_settings"]=self["webpackChunkopenwb_ui_settings"]||[]).push([[5115],{6519:function(e,t,s){s.r(t),s.d(t,{default:function(){return P}});var n=s(6252),a=s(3577);const l=e=>((0,n.dD)("data-v-3fac8230"),e=e(),(0,n.Cn)(),e),o={class:"power"},i=l((()=>(0,n._)("h2",null,"Achtung!",-1))),r=l((()=>(0,n._)("p",null," Vor allen Aktionen auf dieser Seite ist sicherzustellen, dass kein Ladevorgang aktiv ist! Zur Sicherheit bitte zusätzlich alle Fahrzeuge von der Ladestation / den Ladestationen abstecken! ",-1))),c={key:0},d={name:"versionInfoForm"},u={class:"missing-commits"},m={class:"row justify-content-center"},p={class:"col-md-4 d-flex py-1 justify-content-center"},f={name:"updateForm"},h={class:"row justify-content-center"},b={class:"col-md-4 d-flex py-1 justify-content-center"},g={name:"releaseChangeForm"},w=l((()=>(0,n._)("br",null,null,-1))),_=l((()=>(0,n._)("ul",null,[(0,n._)("li",null,"do not allow downgrade")],-1))),y={class:"row justify-content-center"},k={class:"col-md-4 d-flex py-1 justify-content-center"},W={name:"backupForm"},v=l((()=>(0,n._)("a",{href:"/openWB/data/backup/",target:"_blank"},"hier",-1))),B={class:"row justify-content-center"},U={class:"col-md-4 d-flex py-1 justify-content-center"},x={name:"restoreForm"},C=l((()=>(0,n._)("br",null,null,-1))),F={class:"input-group"},S={class:"input-group-prepend"},q={class:"input-group-text"},V={class:"custom-file"},D={id:"input-file-label",class:"custom-file-label",for:"input-file","data-browse":"Suchen"},$={class:"input-group-append"},j=["disabled"],A={class:"row justify-content-center"},T={class:"col-md-4 d-flex py-1 justify-content-center"},z={name:"powerForm"},I={class:"row justify-content-center"},E={class:"col-md-4 d-flex py-1 justify-content-center"},O={class:"col-md-4 d-flex py-1 justify-content-center"};function N(e,t,s,l,N,L){const H=(0,n.up)("openwb-base-button-group-input"),Z=(0,n.up)("openwb-base-alert"),M=(0,n.up)("openwb-base-text-input"),G=(0,n.up)("openwb-base-card"),K=(0,n.up)("font-awesome-icon"),J=(0,n.up)("openwb-base-click-button"),P=(0,n.up)("openwb-base-select-input");return(0,n.wg)(),(0,n.iD)("div",o,[(0,n.Wm)(Z,{subtype:"danger"},{default:(0,n.w5)((()=>[i,r,(0,n.Wm)(H,{title:"Ich habe die Warnung verstanden",buttons:[{buttonValue:!1,text:"Nein",class:"btn-outline-danger"},{buttonValue:!0,text:"Ja",class:"btn-outline-success"}],modelValue:this.warningAcknowledged,"onUpdate:modelValue":t[0]||(t[0]=e=>this.warningAcknowledged=e)},null,8,["modelValue"])])),_:1}),N.warningAcknowledged?((0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("form",d,[(0,n.Wm)(G,{title:"Versions-Informationen"},{footer:(0,n.w5)((()=>[(0,n._)("div",m,[(0,n._)("div",p,[(0,n.Wm)(J,{class:"btn-success",onClick:t[4]||(t[4]=e=>L.sendSystemCommand("systemFetchVersions"))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Informationen aktualisieren "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","download"]})])),_:1})])])])),default:(0,n.w5)((()=>[(0,n.Wm)(M,{title:"Entwicklungszweig",readonly:"",modelValue:e.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":t[1]||(t[1]=t=>e.$store.state.mqtt["openWB/system/current_branch"]=t)},null,8,["modelValue"]),(0,n.Wm)(M,{title:"installierte Version",readonly:"",class:(0,a.C_)(L.updateAvailable?"text-danger":"text-success"),modelValue:e.$store.state.mqtt["openWB/system/current_commit"],"onUpdate:modelValue":t[2]||(t[2]=t=>e.$store.state.mqtt["openWB/system/current_commit"]=t)},null,8,["class","modelValue"]),(0,n.Wm)(M,{title:"aktuellste Version",readonly:"",modelValue:e.$store.state.mqtt["openWB/system/current_branch_commit"],"onUpdate:modelValue":t[3]||(t[3]=t=>e.$store.state.mqtt["openWB/system/current_branch_commit"]=t)},null,8,["modelValue"]),L.updateAvailable?((0,n.wg)(),(0,n.j4)(G,{key:0,title:"Änderungen",subtype:"info",collapsible:!0,collapsed:!0},{default:(0,n.w5)((()=>[(0,n._)("ul",u,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.$store.state.mqtt["openWB/system/current_missing_commits"],((e,t)=>((0,n.wg)(),(0,n.iD)("li",{key:t},(0,a.zw)(e),1)))),128))])])),_:1})):(0,n.kq)("",!0)])),_:1})]),(0,n._)("form",f,[(0,n.Wm)(G,{title:"Aktualisierung",subtype:"success",collapsible:!0,collapsed:!0},{footer:(0,n.w5)((()=>[(0,n._)("div",h,[(0,n._)("div",b,[(0,n.Wm)(J,{class:(0,a.C_)(L.updateAvailable?"btn-success clickable":"btn-outline-success"),disabled:!L.updateAvailable,onClick:t[5]||(t[5]=e=>L.sendSystemCommand("systemUpdate",{}))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Update "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","arrow-alt-circle-up"]})])),_:1},8,["class","disabled"])])])])),default:(0,n.w5)((()=>[(0,n.Wm)(Z,{subtype:"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Nach einem Update wird die Ladestation direkt neu gestartet! Es werden alle lokalen Änderungen mit dem Update verworfen! ")])),_:1})])),_:1})]),(0,n._)("form",g,[(0,n.Wm)(G,{title:"Entwicklungszweig",subtype:"danger",collapsible:!0,collapsed:!0},{footer:(0,n.w5)((()=>[(0,n._)("div",y,[(0,n._)("div",k,[(0,n.Wm)(J,{class:"btn-danger clickable",onClick:t[8]||(t[8]=t=>L.sendSystemCommand("systemUpdate",{branch:e.$store.state.mqtt["openWB/system/current_branch"],tag:N.selectedTag}))},{default:(0,n.w5)((()=>[(0,n.Wm)(K,{"fixed-width":"",icon:["fas","skull-crossbones"]}),(0,n.Uk)(" Branch und Tag wechseln "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","skull-crossbones"]})])),_:1})])])])),default:(0,n.w5)((()=>[(0,n.Wm)(Z,{subtype:"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Nach einem Wechsel wird die Ladestation direkt neu gestartet! Es werden alle lokalen Änderungen mit dem Wechsel verworfen! ")])),_:1}),(0,n.Wm)(Z,{subtype:"warning"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Das ist eine experimentelle Option! Verwendung auf eigene Gefahr. Im schlimmsten Fall muss das system neu installiert werden!"),w,(0,n.Uk)(" ToDo: "),_])),_:1}),(0,n.Wm)(P,{title:"Entwicklungszweig",options:L.getBranchOptions(),"model-value":e.$store.state.mqtt["openWB/system/current_branch"],"onUpdate:modelValue":t[6]||(t[6]=t=>e.updateState("openWB/system/current_branch",t))},null,8,["options","model-value"]),(0,n.Wm)(P,{title:"Tag",options:L.getBranchTagOptions(),modelValue:N.selectedTag,"onUpdate:modelValue":t[7]||(t[7]=e=>N.selectedTag=e)},null,8,["options","modelValue"])])),_:1})]),(0,n._)("form",W,[(0,n.Wm)(G,{title:"Sicherung",subtype:"success",collapsible:!0,collapsed:!0},{footer:(0,n.w5)((()=>[(0,n._)("div",B,[(0,n._)("div",U,[(0,n.Wm)(J,{class:"btn-success clickable",onClick:t[9]||(t[9]=e=>L.sendSystemCommand("createBackup",{use_extended_filename:!0}))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Sicherung erstellen "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","archive"]})])),_:1})])])])),default:(0,n.w5)((()=>[(0,n.Wm)(Z,{subtype:"info"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Nachdem die Sicherung abgeschlossen ist, kann die erstellte Datei über den Link in der Benachrichtigung oder "),v,(0,n.Uk)(" heruntergeladen werden. ")])),_:1})])),_:1})]),(0,n._)("form",x,[(0,n.Wm)(G,{title:"Wiederherstellung",subtype:"success",collapsible:!0,collapsed:!0},{footer:(0,n.w5)((()=>[(0,n._)("div",A,[(0,n._)("div",T,[(0,n.Wm)(J,{class:(0,a.C_)(N.restoreUploadDone?"btn-success clickable":"btn-outline-success"),disabled:!N.restoreUploadDone,onClick:t[12]||(t[12]=e=>L.sendSystemCommand("restoreBackup"))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Wiederherstellung starten "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","box-open"]})])),_:1},8,["class","disabled"])])])])),default:(0,n.w5)((()=>[(0,n.Wm)(Z,{subtype:"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Diese Funktion ist noch in Entwicklung! Es kann potentiell das System unbrauchbar werden. Nach Möglichkeit vorher ein Image der Installation erstellen!"),C,(0,n.Uk)(" Für die Wiederherstellung wird eine aktive Internetverbindung benötigt. ")])),_:1}),(0,n._)("div",F,[(0,n._)("div",S,[(0,n._)("div",q,[(0,n.Wm)(K,{"fixed-width":"",icon:["fas","file-archive"]})])]),(0,n._)("div",V,[(0,n._)("input",{id:"input-file",type:"file",class:"custom-file-input",accept:".tar.gz,application/gzip,application/tar+gzip",onChange:t[10]||(t[10]=e=>L.updateSelectedFile(e))},null,32),(0,n._)("label",D,(0,a.zw)(N.selectedFile?N.selectedFile.name:"Bitte eine Datei auswählen"),1)]),(0,n._)("div",$,[(0,n._)("button",{class:(0,a.C_)(["btn",N.selectedFile?"btn-success clickable":"btn-outline-success"]),disabled:!N.selectedFile,type:"button",onClick:t[11]||(t[11]=e=>L.uploadFile())},[(0,n.Uk)(" Hochladen "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","upload"]})],10,j)])])])),_:1})]),(0,n._)("form",z,[(0,n.Wm)(G,{title:"Betrieb",collapsible:!0,collapsed:!0},{footer:(0,n.w5)((()=>[(0,n._)("div",I,[(0,n._)("div",E,[(0,n.Wm)(J,{class:"btn-warning",onClick:t[13]||(t[13]=e=>L.sendSystemCommand("systemReboot"))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Neustart "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","undo"]})])),_:1})]),(0,n._)("div",O,[(0,n.Wm)(J,{class:"btn-danger",onClick:t[14]||(t[14]=e=>L.sendSystemCommand("systemShutdown"))},{default:(0,n.w5)((()=>[(0,n.Uk)(" Ausschalten "),(0,n.Wm)(K,{"fixed-width":"",icon:["fas","power-off"]})])),_:1})])])])),default:(0,n.w5)((()=>[(0,n.Wm)(Z,{subtype:"danger"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Wenn die Ladestation ausgeschaltet wird, muss sie komplett spannungsfrei geschaltet werden. Erst beim erneuten Zuschalten der Spannung fährt das System wieder hoch. ")])),_:1})])),_:1})])])):(0,n.kq)("",!0)])}var L=s(8947),H=s(1436),Z=s(7810),M=s(7029);L.vI.add(H.q9j,H.X7o,H.oTz,H.q7m,H.QmK,H.N2j,H.W2U,H.cf$,H.IA$);var G={name:"OpenwbSystem",mixins:[M.Z],emits:["sendCommand"],components:{FontAwesomeIcon:Z.GN},data(){return{mqttTopicsToSubscribe:["openWB/system/current_commit","openWB/system/current_branch_commit","openWB/system/current_missing_commits","openWB/system/available_branches","openWB/system/current_branch"],warningAcknowledged:!1,selectedTag:"*HEAD*",selectedFile:void 0,restoreUploadDone:!1}},computed:{updateAvailable(){return this.$store.state.mqtt["openWB/system/current_branch_commit"]&&this.$store.state.mqtt["openWB/system/current_branch_commit"]!=this.$store.state.mqtt["openWB/system/current_commit"]}},methods:{sendSystemCommand(e,t={}){this.$emit("sendCommand",{command:e,data:t})},getBranchOptions(){var e=this.$store.state.mqtt["openWB/system/available_branches"],t=[];if(void 0!==e)for(const[s,n]of Object.entries(e))t.push({value:s,text:s+" ("+n.commit+")"});return t},getBranchTagOptions(){var e=this.$store.state.mqtt["openWB/system/available_branches"][this.$store.state.mqtt["openWB/system/current_branch"]]["tags"],t=[];if(void 0!==e)for(const[s,n]of Object.entries(e))t.unshift({value:s,text:n});return t.unshift({value:"*HEAD*",text:"Aktuellster Stand"}),t},updateSelectedFile(e){this.selectedFile=e.target.files[0],console.log("selectedFile",this.selectedFile)},uploadFile(){if(void 0!==this.selectedFile){let e=new FormData;e.append("backupFile",this.selectedFile),this.axios.post(location.protocol+"//"+location.host+"/openWB/web/settings/uploadBackup.php",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{console.log("POST response",e.data);const t="Die Sicherungsdatei wurde erfolgreich hochgeladen. Sie können die Wiederherstellung jetzt starten.",s=Math.floor(Date.now()/1e3);this.$store.commit("addTopic",{topic:"openWB/command/"+this.$root.mqttClientId+"/messages/"+s,payload:{source:"command",type:"success",message:t,timestamp:s}}),this.restoreUploadDone=!0})).catch((e=>{var t="Hochladen der Datei fehlgeschlagen!<br />";e.response?(console.log(e.response.status,e.response.data),t+=e.response.status+": "+e.response.data):e.request?(console.log(e.request),t+="Es wurde keine Antwort vom Server empfangen."):(console.log("Error",e.message),t+="Es ist ein unbekannter Fehler aufgetreten.");const s=Math.floor(Date.now()/1e3);this.$store.commit("addTopic",{topic:"openWB/command/"+this.$root.mqttClientId+"/messages/"+s,payload:{source:"command",type:"danger",message:t,timestamp:s}}),this.restoreUploadDone=!1}))}else console.error("no file selected for upload")}}},K=s(3744);const J=(0,K.Z)(G,[["render",N],["__scopeId","data-v-3fac8230"]]);var P=J}}]);
//# sourceMappingURL=SystemConfig.7c98aacd.js.map