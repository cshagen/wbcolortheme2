"use strict";(self["webpackChunkopenwb_ui_settings"]=self["webpackChunkopenwb_ui_settings"]||[]).push([[3488],{9452:function(e,t,a){a.r(t),a.d(t,{default:function(){return Oe}});var i=a(6252);const l=e=>((0,i.dD)("data-v-55aa0fc1"),e=e(),(0,i.Cn)(),e),o={class:"chargeLog"},s={name:"chargeLogForm"},n={class:"row justify-content-center"},r={key:1},g={key:0},c={class:"row justify-content-center"},d={class:"hide",ref:"downloadChargeLogLink"},p=l((()=>(0,i._)("div",{class:"row"},[(0,i._)("div",{class:"col"},[(0,i._)("h2",null,"Summe")])],-1)));function u(e,t,a,l,u,h){const m=(0,i.up)("openwb-base-text-input"),v=(0,i.up)("font-awesome-icon"),w=(0,i.up)("openwb-base-button-group-input"),b=(0,i.up)("openwb-base-select-input"),f=(0,i.up)("openwb-base-card"),_=(0,i.up)("openwb-base-click-button"),k=(0,i.up)("openwb-base-alert"),y=(0,i.up)("vue3-table-lite");return(0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("form",s,[(0,i.Wm)(f,{title:"Filter"},{footer:(0,i.w5)((()=>[(0,i._)("div",n,[(0,i.Wm)(_,{class:"col-4 btn-success",onClick:t[5]||(t[5]=e=>h.requestChargeLog())},{default:(0,i.w5)((()=>[(0,i.Uk)(" Filter anwenden ")])),_:1})])])),default:(0,i.w5)((()=>[(0,i.Wm)(m,{title:"Zeitraum",subtype:"month",min:"2018-01",max:u.currentMonth,modelValue:h.chargeLogDate,"onUpdate:modelValue":t[0]||(t[0]=e=>h.chargeLogDate=e)},null,8,["max","modelValue"]),(0,i.Wm)(f,{title:"Erweiterte Optionen",collapsible:!0,collapsed:!0},{header:(0,i.w5)((()=>[(0,i.Wm)(v,{"fixed-width":"",icon:["fas","filter"]}),(0,i.Uk)(" Erweiterte Optionen ")])),default:(0,i.w5)((()=>[(0,i.Wm)(w,{title:"Priorität",buttons:[{buttonValue:void 0,text:"Alle"},{buttonValue:!1,text:"Aus",class:"btn-outline-danger"},{buttonValue:!0,text:"An",class:"btn-outline-success"}],modelValue:u.chargeLogRequestData.filter.vehicle.prio,"onUpdate:modelValue":t[1]||(t[1]=e=>u.chargeLogRequestData.filter.vehicle.prio=e)},null,8,["modelValue"]),(0,i.Wm)(b,{title:"Lademodus",multiple:"",options:h.chargeModeList,modelValue:u.chargeLogRequestData.filter.vehicle.chargemode,"onUpdate:modelValue":t[2]||(t[2]=e=>u.chargeLogRequestData.filter.vehicle.chargemode=e)},{help:(0,i.w5)((()=>[(0,i.Uk)(" Es können mehrere Elemente ausgewählt werden. ")])),_:1},8,["options","modelValue"]),(0,i.Wm)(b,{title:"Ladepunkt",multiple:"",options:h.chargePointList,modelValue:u.chargeLogRequestData.filter.chargepoint.id,"onUpdate:modelValue":t[3]||(t[3]=e=>u.chargeLogRequestData.filter.chargepoint.id=e)},{help:(0,i.w5)((()=>[(0,i.Uk)(" Es können mehrere Elemente ausgewählt werden. ")])),_:1},8,["options","modelValue"]),(0,i.Wm)(b,{title:"Fahrzeug",multiple:"",options:h.vehicleList,modelValue:u.chargeLogRequestData.filter.vehicle.id,"onUpdate:modelValue":t[4]||(t[4]=e=>u.chargeLogRequestData.filter.vehicle.id=e)},{help:(0,i.w5)((()=>[(0,i.Uk)(" Es können mehrere Elemente ausgewählt werden. ")])),_:1},8,["options","modelValue"])])),_:1})])),_:1}),h.chargeLogRead?((0,i.wg)(),(0,i.iD)("div",r,[(0,i.Wm)(y,{class:"charge-log-table","is-static-mode":!0,columns:u.table.columns,rows:h.chargeLogDataset,total:h.totalRecordCount,sortable:u.table.sortable,messages:u.table.messages,"page-options":u.table.pageOptions,limit:25},null,8,["columns","rows","total","sortable","messages","page-options"]),h.totalRecordCount>0?((0,i.wg)(),(0,i.iD)("div",g,[(0,i._)("div",c,[(0,i.Wm)(_,{class:"col-4 btn-success",onClick:t[6]||(t[6]=e=>h.downloadChargeLog())},{default:(0,i.w5)((()=>[(0,i.Uk)(" Als CSV exportieren "),(0,i.Wm)(v,{"fixed-width":"",icon:["fas","download"]})])),_:1}),(0,i._)("a",d,null,512)]),p,(0,i.Wm)(y,{class:"charge-log-totals","is-static-mode":!0,"is-hide-paging":!0,columns:u.totals.columns,rows:h.chargeLogTotals,total:1},null,8,["columns","rows"])])):(0,i.kq)("",!0)])):((0,i.wg)(),(0,i.j4)(k,{key:0,subtype:"info"},{default:(0,i.w5)((()=>[(0,i.Uk)(" Es wurden noch keine Daten abgerufen. ")])),_:1}))])])}var h=a(8947),m=a(1436),v=a(7810),w=a(3577),b=a(9963);const f=e=>((0,i.dD)("data-v-6f36d323"),e=e(),(0,i.Cn)(),e),_={class:"vtl vtl-card"},k={key:0,class:"vtl-card-title"},y={class:"vtl-card-body"},D={class:"vtl-row"},C={key:0,class:"vtl-loading-mask"},L=f((()=>(0,i._)("div",{class:"vtl-loading-content"},[(0,i._)("span",{style:{color:"white"}},"Loading...")],-1))),x=[L],R={class:"vtl-thead"},q={class:"vtl-thead-tr"},S={key:0,class:"vtl-thead-th vtl-checkbox-th"},P=["onClick"],E=["set"],F={key:0,class:"vtl-tbody-tr vtl-group-tr"},z=["colspan"],H={class:"flex"},M={key:0,class:"animation"},T=["onClick"],K=["innerHTML"],W=["name","onClick"],j={key:0,class:"vtl-tbody-td"},A=["value"],O=["innerHTML"],V={key:1},Y={key:0},B={key:1},N=["set"],U={key:0,class:"vtl-tbody-tr vtl-group-tr"},I=["colspan"],$={class:"flex"},G={key:0,class:"animation"},Z=["onClick"],J=["innerHTML"],X=["name","onClick"],Q={key:0,class:"vtl-tbody-td"},ee=["value"],te=["innerHTML"],ae={key:1},ie={key:0},le={key:1},oe={key:0,class:"vtl-paging vtl-row"},se={class:"vtl-paging-info col-sm-12 col-md-4"},ne={role:"status","aria-live":"polite"},re={class:"vtl-paging-change-div col-sm-12 col-md-4"},ge={class:"vtl-paging-count-label"},ce=["value"],de={class:"vtl-paging-page-label"},pe=["value"],ue={class:"vtl-paging-pagination-div col-sm-12 col-md-4"},he={class:"dataTables_paginate"},me={class:"vtl-paging-pagination-ul vtl-pagination"},ve=f((()=>(0,i._)("span",{"aria-hidden":"true"},"«",-1))),we=f((()=>(0,i._)("span",{class:"sr-only"},"First",-1))),be=[ve,we],fe=f((()=>(0,i._)("span",{"aria-hidden":"true"},"<",-1))),_e=f((()=>(0,i._)("span",{class:"sr-only"},"Prev",-1))),ke=[fe,_e],ye=["onClick"],De=f((()=>(0,i._)("span",{"aria-hidden":"true"},">",-1))),Ce=f((()=>(0,i._)("span",{class:"sr-only"},"Next",-1))),Le=[De,Ce],xe=f((()=>(0,i._)("span",{"aria-hidden":"true"},"»",-1))),Re=f((()=>(0,i._)("span",{class:"sr-only"},"Last",-1))),qe=[xe,Re],Se={key:1,class:"vtl-row"},Pe={class:"vtl-empty-msg col-sm-12 text-center"};function Ee(e,t,a,l,o,s){return(0,i.wg)(),(0,i.iD)("div",_,[e.title?((0,i.wg)(),(0,i.iD)("div",k,(0,w.zw)(e.title),1)):(0,i.kq)("",!0),(0,i._)("div",y,[(0,i._)("div",D,[(0,i._)("div",{class:(0,w.C_)(["col-sm-12",{"fixed-first-column":e.isFixedFirstColumn,"fixed-first-second-column":e.isFixedFirstColumn&&e.hasCheckbox}])},[e.isLoading?((0,i.wg)(),(0,i.iD)("div",C,x)):(0,i.kq)("",!0),(0,i._)("table",{class:"vtl-table vtl-table-hover vtl-table-bordered vtl-table-responsive vtl-table-responsive-sm",ref:"localTable",style:(0,w.j5)("max-height: "+e.maxHeight+"px;")},[(0,i._)("thead",R,[(0,i._)("tr",q,[e.hasCheckbox?((0,i.wg)(),(0,i.iD)("th",S,[(0,i._)("div",null,[(0,i.wy)((0,i._)("input",{type:"checkbox",class:"vtl-thead-checkbox","onUpdate:modelValue":t[0]||(t[0]=t=>e.setting.isCheckAll=t)},null,512),[[b.e8,e.setting.isCheckAll]])])])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.columns,((t,a)=>((0,i.wg)(),(0,i.iD)("th",{class:(0,w.C_)(["vtl-thead-th",t.headerClasses]),key:a,style:(0,w.j5)(Object.assign({width:t.width?t.width:"auto"},t.headerStyles))},[(0,i._)("div",{class:(0,w.C_)(["vtl-thead-column",{"vtl-sortable":t.sortable,"vtl-both":t.sortable,"vtl-asc":e.setting.order===t.field&&"asc"===e.setting.sort,"vtl-desc":e.setting.order===t.field&&"desc"===e.setting.sort}]),onClick:a=>!!t.sortable&&e.doSort(t.field)},(0,w.zw)(t.label),11,P)],6)))),128))])]),e.rows.length>0?((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[e.isStaticMode?((0,i.wg)(),(0,i.iD)("tbody",{key:0,class:"vtl-tbody",set:e.templateRows=""==e.groupingKey?[e.localRows]:e.localRows},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.templateRows,((a,l)=>((0,i.wg)(),(0,i.iD)(i.HY,{key:l},[""!=e.groupingKey?((0,i.wg)(),(0,i.iD)("tr",F,[(0,i._)("td",{colspan:e.hasCheckbox?e.columns.length+1:e.columns.length,class:"vtl-tbody-td vtl-group-td"},[(0,i._)("div",H,[e.hasGroupToggle?((0,i.wg)(),(0,i.iD)("div",M,[(0,i._)("a",{class:"cursor-pointer",onClick:t=>e.toggleGroup(t,l)},"▼",8,T)])):(0,i.kq)("",!0),(0,i._)("div",{class:"ml-2",innerHTML:e.groupingDisplay?e.groupingDisplay(l):l},null,8,K)])],8,z)])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a,((a,o)=>((0,i.wg)(),(0,i.iD)("tr",{key:o,name:"vtl-group-"+l,class:(0,w.C_)(["vtl-tbody-tr","function"===typeof e.rowClasses?e.rowClasses(a):e.rowClasses]),onClick:t=>e.$emit("row-clicked",a)},[e.hasCheckbox?((0,i.wg)(),(0,i.iD)("td",j,[(0,i._)("div",null,[(0,i._)("input",{type:"checkbox",class:"vtl-tbody-checkbox",ref_for:!0,ref:t=>{e.rowCheckbox.push(t)},value:a[e.setting.keyColumn],onClick:t[1]||(t[1]=(...t)=>e.checked&&e.checked(...t))},null,8,A)])])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.columns,((t,l)=>((0,i.wg)(),(0,i.iD)("td",{key:l,class:(0,w.C_)(["vtl-tbody-td",t.columnClasses]),style:(0,w.j5)(t.columnStyles)},[t.display?((0,i.wg)(),(0,i.iD)("div",{key:0,innerHTML:t.display(a)},null,8,O)):((0,i.wg)(),(0,i.iD)("div",V,[e.setting.isSlotMode&&e.slots[t.field]?((0,i.wg)(),(0,i.iD)("div",Y,[(0,i.WI)(e.$slots,t.field,{value:a},void 0,!0)])):((0,i.wg)(),(0,i.iD)("span",B,(0,w.zw)(a[t.field]),1))]))],6)))),128))],10,W)))),128))],64)))),128))],8,E)):((0,i.wg)(),(0,i.iD)("tbody",{key:1,set:e.templateRows=""==e.groupingKey?[e.rows]:e.groupingRows},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.templateRows,((a,l)=>((0,i.wg)(),(0,i.iD)(i.HY,{key:l},[""!=e.groupingKey?((0,i.wg)(),(0,i.iD)("tr",U,[(0,i._)("td",{colspan:e.hasCheckbox?e.columns.length+1:e.columns.length,class:"vtl-tbody-td vtl-group-td"},[(0,i._)("div",$,[e.hasGroupToggle?((0,i.wg)(),(0,i.iD)("div",G,[(0,i._)("a",{class:"cursor-pointer",onClick:t=>e.toggleGroup(t,l)},"▼",8,Z)])):(0,i.kq)("",!0),(0,i._)("div",{class:"ml-2",innerHTML:e.groupingDisplay?e.groupingDisplay(l):l},null,8,J)])],8,I)])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a,((a,o)=>((0,i.wg)(),(0,i.iD)("tr",{name:"vtl-group-"+l,key:o,class:(0,w.C_)(["vtl-tbody-tr","function"===typeof e.rowClasses?e.rowClasses(a):e.rowClasses]),onClick:t=>e.$emit("row-clicked",a)},[e.hasCheckbox?((0,i.wg)(),(0,i.iD)("td",Q,[(0,i._)("div",null,[(0,i._)("input",{type:"checkbox",class:"vtl-tbody-checkbox",ref_for:!0,ref:t=>{e.rowCheckbox.push(t)},value:a[e.setting.keyColumn],onClick:t[2]||(t[2]=(...t)=>e.checked&&e.checked(...t))},null,8,ee)])])):(0,i.kq)("",!0),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.columns,((t,l)=>((0,i.wg)(),(0,i.iD)("td",{key:l,class:(0,w.C_)(["vtl-tbody-td",t.columnClasses]),style:(0,w.j5)(t.columnStyles)},[t.display?((0,i.wg)(),(0,i.iD)("div",{key:0,innerHTML:t.display(a)},null,8,te)):((0,i.wg)(),(0,i.iD)("div",ae,[e.setting.isSlotMode&&e.slots[t.field]?((0,i.wg)(),(0,i.iD)("div",ie,[(0,i.WI)(e.$slots,t.field,{value:a},void 0,!0)])):((0,i.wg)(),(0,i.iD)("span",le,(0,w.zw)(a[t.field]),1))]))],6)))),128))],10,X)))),128))],64)))),128))],8,N))],64)):(0,i.kq)("",!0)],4)],2)]),e.rows.length>0?((0,i.wg)(),(0,i.iD)("div",oe,[e.setting.isHidePaging?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)(i.HY,{key:0},[(0,i._)("div",se,[(0,i._)("div",ne,(0,w.zw)(e.stringFormat(e.messages.pagingInfo,e.setting.offset,e.setting.limit,e.total)),1)]),(0,i._)("div",re,[(0,i._)("span",ge,(0,w.zw)(e.messages.pageSizeChangeLabel),1),(0,i.wy)((0,i._)("select",{class:"vtl-paging-count-dropdown","onUpdate:modelValue":t[3]||(t[3]=t=>e.setting.pageSize=t)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.pageOptions,(e=>((0,i.wg)(),(0,i.iD)("option",{value:e.value,key:e.value},(0,w.zw)(e.text),9,ce)))),128))],512),[[b.bM,e.setting.pageSize]]),(0,i._)("span",de,(0,w.zw)(e.messages.gotoPageLabel),1),(0,i.wy)((0,i._)("select",{class:"vtl-paging-page-dropdown","onUpdate:modelValue":t[4]||(t[4]=t=>e.setting.page=t)},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.setting.maxPage,(e=>((0,i.wg)(),(0,i.iD)("option",{key:e,value:parseInt(e)},(0,w.zw)(e),9,pe)))),128))],512),[[b.bM,e.setting.page]])]),(0,i._)("div",ue,[(0,i._)("div",he,[(0,i._)("ul",me,[(0,i._)("li",{class:(0,w.C_)(["vtl-paging-pagination-page-li vtl-paging-pagination-page-li-first page-item",{disabled:e.setting.page<=1}])},[(0,i._)("a",{class:"vtl-paging-pagination-page-link vtl-paging-pagination-page-link-first page-link",href:"javascript:void(0)","aria-label":"Previous",onClick:t[5]||(t[5]=t=>e.setting.page=1)},be)],2),(0,i._)("li",{class:(0,w.C_)(["vtl-paging-pagination-page-li vtl-paging-pagination-page-li-prev page-item",{disabled:e.setting.page<=1}])},[(0,i._)("a",{class:"vtl-paging-pagination-page-link vtl-paging-pagination-page-link-prev page-link",href:"javascript:void(0)","aria-label":"Previous",onClick:t[6]||(t[6]=(...t)=>e.prevPage&&e.prevPage(...t))},ke)],2),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.setting.paging,(t=>((0,i.wg)(),(0,i.iD)("li",{class:(0,w.C_)(["vtl-paging-pagination-page-li vtl-paging-pagination-page-li-number page-item",{disabled:e.setting.page===t}]),key:t},[(0,i._)("a",{class:"vtl-paging-pagination-page-link vtl-paging-pagination-page-link-number page-link",href:"javascript:void(0)",onClick:a=>e.movePage(t)},(0,w.zw)(t),9,ye)],2)))),128)),(0,i._)("li",{class:(0,w.C_)(["vtl-paging-pagination-page-li vtl-paging-pagination-page-li-next page-item",{disabled:e.setting.page>=e.setting.maxPage}])},[(0,i._)("a",{class:"vtl-paging-pagination-page-link vtl-paging-pagination-page-link-next page-link",href:"javascript:void(0)","aria-label":"Next",onClick:t[7]||(t[7]=(...t)=>e.nextPage&&e.nextPage(...t))},Le)],2),(0,i._)("li",{class:(0,w.C_)(["vtl-paging-pagination-page-li vtl-paging-pagination-page-li-last page-item",{disabled:e.setting.page>=e.setting.maxPage}])},[(0,i._)("a",{class:"vtl-paging-pagination-page-link vtl-paging-pagination-page-link-last page-link",href:"javascript:void(0)","aria-label":"Next",onClick:t[8]||(t[8]=t=>e.setting.page=e.setting.maxPage)},qe)],2)])])])],64))])):((0,i.wg)(),(0,i.iD)("div",Se,[(0,i._)("div",Pe,(0,w.zw)(e.messages.noDataAvailable),1)]))])])}var Fe=a(2262),ze=(0,i.aZ)({name:"my-table",emits:["return-checked-rows","do-search","is-finished","get-now-page","row-clicked"],props:{isLoading:{type:Boolean,require:!0},isReSearch:{type:Boolean,require:!0},hasCheckbox:{type:Boolean,default:!1},checkedReturnType:{type:String,default:"key"},title:{type:String,default:""},isFixedFirstColumn:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},rowClasses:{type:[Array,Function],default:()=>[]},pageSize:{type:Number,default:10},total:{type:Number,default:100},page:{type:Number,default:1},sortable:{type:Object,default:()=>({order:"id",sort:"asc"})},messages:{type:Object,default:()=>({pagingInfo:"Showing {0}-{1} of {2}",pageSizeChangeLabel:"Row count:",gotoPageLabel:"Go to page:",noDataAvailable:"No data"})},isStaticMode:{type:Boolean,default:!1},isSlotMode:{type:Boolean,default:!1},isHidePaging:{type:Boolean,default:!1},pageOptions:{type:Array,default:()=>[{value:10,text:10},{value:25,text:25},{value:50,text:50}]},groupingKey:{type:String,default:""},hasGroupToggle:{type:Boolean,default:!1},groupingDisplay:{type:Function,default:null},maxHeight:{default:"auto"}},setup(e,{emit:t,slots:a}){let l=(0,Fe.iH)(null),o=e.pageOptions.length>0?(0,Fe.iH)(e.pageOptions[0].value):(0,Fe.iH)(e.pageSize);e.pageOptions.length>0&&e.pageOptions.forEach((t=>{Object.prototype.hasOwnProperty.call(t,"value")&&Object.prototype.hasOwnProperty.call(t,"text")&&e.pageSize==t.value&&(o.value=t.value)}));const s=(0,Fe.qj)({isSlotMode:e.isSlotMode,isCheckAll:!1,isHidePaging:e.isHidePaging,keyColumn:(0,i.Fl)((()=>{let t="";return Object.assign(e.columns).forEach((e=>{e.isKey&&(t=e.field)})),t})),page:e.page,pageSize:o.value,maxPage:(0,i.Fl)((()=>{if(e.total<=0)return 0;let t=Math.floor(e.total/s.pageSize),a=e.total%s.pageSize;return a>0&&t++,t})),offset:(0,i.Fl)((()=>(s.page-1)*s.pageSize+1)),limit:(0,i.Fl)((()=>{let t=s.page*s.pageSize;return e.total>=t?t:e.total})),paging:(0,i.Fl)((()=>{let e=s.page-2<=0?1:s.page-2;s.maxPage-s.page<=2&&(e=s.maxPage-4),e=e<=0?1:e;let t=[];for(let a=e;a<=s.maxPage;a++)t.length<5&&t.push(a);return t})),order:e.sortable.order,sort:e.sortable.sort,pageOptions:e.pageOptions}),n=(0,i.Fl)((()=>{let t=e.rows;var a=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});let l="desc"===s.sort?-1:1;t.sort((function(e,t){return a.compare(e[s.order],t[s.order])*l}));let o=null;if(e.groupingKey){let a={};t.forEach((t=>{a[t[e.groupingKey]]||(a[t[e.groupingKey]]=[]),a[t[e.groupingKey]].push(t)})),o={};for(let i=s.offset-1;i<s.limit;i++)o[t[i][e.groupingKey]]=a[t[i][e.groupingKey]]}else{o=[];for(let e=s.offset-1;e<s.limit;e++)o.push(t[e])}return(0,i.Y3)((function(){b()})),o})),r=(0,Fe.iH)([]);e.hasCheckbox&&((0,i.Xn)((()=>{r.value=[]})),(0,i.YP)((()=>s.isCheckAll),(a=>{let i=[];r.value.forEach(((t,l)=>{t&&(t.checked=a,t.checked&&("row"==e.checkedReturnType?i.push(n.value[l]):i.push(t.value)))})),t("return-checked-rows",i)})));const g=a=>{a.stopPropagation();let i=[];r.value.forEach(((t,a)=>{t&&t.checked&&("row"==e.checkedReturnType?i.push(n.value[a]):i.push(t.value))})),t("return-checked-rows",i)},c=()=>{r.value.forEach((e=>{e&&e.checked&&(e.checked=!1)})),t("return-checked-rows",[])},d=a=>{let i="asc";a==s.order&&"asc"==s.sort&&(i="desc");let l=(s.page-1)*s.pageSize,o=s.pageSize;s.order=a,s.sort=i,t("do-search",l,o,a,i),s.isCheckAll?s.isCheckAll=!1:e.hasCheckbox&&c()},p=(a,i)=>{s.isCheckAll=!1;let l=s.order,o=s.sort,n=(a-1)*s.pageSize,r=s.pageSize;(!e.isReSearch||a>1||a==i)&&t("do-search",n,r,l,o)};(0,i.YP)((()=>s.page),p),(0,i.YP)((()=>e.page),(e=>{e<=1?(s.page=1,t("get-now-page",s.page)):e>=s.maxPage?(s.page=s.maxPage,t("get-now-page",s.page)):s.page=e}));const u=()=>{1===s.page?p(s.page,s.page):(s.page=1,s.isCheckAll=!1)};(0,i.YP)((()=>s.pageSize),u),(0,i.YP)((()=>e.pageSize),(e=>{s.pageSize=e}));const h=()=>{if(1==s.page)return!1;s.page--},m=e=>{s.page=e},v=()=>{if(s.page>=s.maxPage)return!1;s.page++};(0,i.YP)((()=>e.rows),(()=>{(e.isReSearch||e.isStaticMode)&&(s.page=1),(0,i.Y3)((function(){e.isStaticMode||b()}))}));const w=(e,...t)=>e.replace(/{(\d+)}/g,(function(e,a){return"undefined"!=typeof t[a]?t[a]:e})),b=()=>{if(l.value){let e=l.value.getElementsByClassName("is-rows-el");t("is-finished",e)}t("get-now-page",s.page)},f=(0,i.Fl)((()=>{let t={};return e.rows.forEach((a=>{t[a[e.groupingKey]]||(t[a[e.groupingKey]]=[]),t[a[e.groupingKey]].push(a)})),(0,i.Y3)((function(){b()})),t})),_=(e,t)=>{e.target.parentElement.classList.toggle("rotated-90"),document.getElementsByName("vtl-group-"+t).forEach((e=>{e.classList.toggle("hidden")}))};return(0,i.bv)((()=>{(0,i.Y3)((()=>{e.rows.length>0&&b()}))})),e.hasCheckbox?{slots:a,localTable:l,localRows:n,setting:s,rowCheckbox:r,checked:g,doSort:d,prevPage:h,movePage:m,nextPage:v,stringFormat:w,groupingRows:f,toggleGroup:_}:{slots:a,localTable:l,localRows:n,setting:s,doSort:d,prevPage:h,movePage:m,nextPage:v,stringFormat:w,groupingRows:f,toggleGroup:_}}}),He=a(3744);const Me=(0,He.Z)(ze,[["render",Ee],["__scopeId","data-v-6f36d323"]]);var Te=Me,Ke=Te,We=a(7029);h.vI.add(m.G_j,m.q7m);var je={name:"OpenwbChargeLog",components:{Vue3TableLite:Ke,FontAwesomeIcon:v.GN},mixins:[We.Z],emits:["sendCommand"],data(){return{dateTimeFormat:new Intl.DateTimeFormat("de-DE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),mqttTopicsToSubscribe:["openWB/general/extern","openWB/chargepoint/+/config","openWB/vehicle/+/name"],currentMonth:"",chargeLogRequestData:{month:"",year:"",filter:{chargepoint:{id:[]},vehicle:{id:[],chargemode:[],prio:void 0}}},downloadFile:null,table:{messages:{pagingInfo:"Einträge {0}-{1} von {2}",pageSizeChangeLabel:"Einträge:",gotoPageLabel:" Gehe zu:",noDataAvailable:"Keine Einträge gefunden."},pageOptions:[{value:5,text:"5"},{value:10,text:"10"},{value:25,text:"25"},{value:50,text:"50"},{value:100,text:"100"}],columns:[{label:"Beginn",field:"time_begin",sortable:!0,display:e=>this.dateTimeFormat.format(new Date(1e3*e.time_begin))},{label:"Ende",field:"time_end",sortable:!0,display:e=>this.dateTimeFormat.format(new Date(1e3*e.time_end))},{label:"Fahrzeug",field:"vehicle_name",sortable:!0},{label:"Dauer",field:"time_time_charged",sortable:!0,display:e=>this.alignEnd(e.time_time_charged)},{label:"Energie",field:"data_imported_since_mode_switch",sortable:!0,display:e=>this.alignEnd(this.formatNumber(e.data_imported_since_mode_switch/1e3,2)+"&nbsp;kWh / "+this.formatNumber(e.data_range_charged,0)+"&nbsp;km")},{label:"Kosten",field:"data_costs",sortable:!0,display:e=>this.alignEnd(this.formatNumber(e.data_costs,2)+"&nbsp;€")},{label:"Lademodus",field:"vehicle_chargemode",sortable:!0,display:e=>'<div class="td-center tag '+this.getChargeModeClass(e.vehicle_chargemode)+'">'+e.vehicle_chargemode+"</div>"},{label:"Ladepunkt",field:"chargepoint_name",sortable:!0},{label:"Priorität",field:"vehicle_prio",display:e=>this.translateBool(e.vehicle_prio)}],sortable:{order:"time_begin",sort:"asc"}},totals:{columns:[{label:"Dauer",field:"time_charged",sortable:!1,display:e=>this.alignEnd(e.time_charged)},{label:"Energie",field:"imported_since_plugged",sortable:!1,display:e=>this.alignEnd(this.formatNumber(e.imported_since_plugged/1e3,2)+"&nbsp;kWh")},{label:"Reichweite",field:"range_charged",sortable:!1,display:e=>this.alignEnd(this.formatNumber(e.range_charged,0)+"&nbsp;km")},{label:"Kosten",field:"costs",sortable:!1,display:e=>this.alignEnd(this.formatNumber(e.costs,2)+"&nbsp;€")}]}}},computed:{chargeLogDate:{get(){return this.chargeLogRequestData.year+"-"+this.chargeLogRequestData.month},set(e){let t=e.split("-");this.chargeLogRequestData.year=t[0],this.chargeLogRequestData.month=t[1]}},chargeLogTotals(){return this.$store.state.mqtt["openWB/log/"+this.mqttClientId+"/data"]?[this.$store.state.mqtt["openWB/log/"+this.mqttClientId+"/data"]["totals"]]:[]},chargeLogDataset:{get(){try{return this.$store.state.mqtt["openWB/log/"+this.mqttClientId+"/data"]["entries"].map((e=>({chargepoint_id:e["chargepoint"]["id"],chargepoint_name:e["chargepoint"]["name"],vehicle_id:e["vehicle"]["id"],vehicle_name:e["vehicle"]["name"],vehicle_chargemode:this.translateChargeMode(e["vehicle"]["chargemode"]),vehicle_rfid:e["vehicle"]["rfid"],vehicle_prio:e["vehicle"]["prio"],time_begin:Date.parse(e["time"]["begin"])/1e3,time_end:Date.parse(e["time"]["end"])/1e3,time_time_charged:e["time"]["time_charged"],data_power:e["data"]["power"],data_range_charged:e["data"]["range_charged"],data_costs:e["data"]["costs"],data_imported_since_plugged:e["data"]["imported_since_plugged"],data_imported_since_mode_switch:e["data"]["imported_since_mode_switch"]})))}catch(e){return[]}}},chargeLogCsv:{get(){const e=[["Ladepunkt-ID","Ladepunkt","Fahrzeug-ID","Fahrzeug","Lademodus","Priorität","Beginn","Ende","Dauer","Leistung","Energie","Reichweite","Kosten"],...this.chargeLogDataset.map((e=>[e.chargepoint_id,'"'+e.chargepoint_name+'"',e.vehicle_id,'"'+e.vehicle_name+'"','"'+e.vehicle_chargemode+'"','"'+this.translateBool(e.vehicle_prio,!1)+'"','"'+e.time_begin+'"','"'+e.time_end+'"','"'+e.time_time_charged+'"',this.formatNumber(e.data_power/1e3,3),this.formatNumber(e.data_imported_since_mode_switch/1e3,2),this.formatNumber(e.data_range_charged,0),this.formatNumber(e.data_costs/1e3,2)]))].map((e=>e.join(";"))).join("\n");return e}},chargeLogRead:{get(){return void 0!=this.chargeLogDataset}},chargeLogHasEntries:{get(){return void 0!=this.chargeLogDataset&&this.chargeLogDataset.length>0}},totalRecordCount(){return this.chargeLogDataset.length},chargeModeList(){let e=this.chargeModes.map((e=>({value:e,text:this.translateChargeMode(e)})));return e.unshift({value:void 0,text:"Alle"}),e},chargePointList(){let e=this.getWildcardTopics("openWB/chargepoint/+/config");var t=[{value:void 0,text:"Alle"}];for(const[,a]of Object.entries(e))t.push({value:a.id,text:a.name});return t},vehicleList(){let e=this.getWildcardTopics("openWB/vehicle/+/name");var t=[{value:void 0,text:"Alle"}];for(const[a,i]of Object.entries(e)){let e=parseInt(a.match(/\/([0-9]+)\/name$/)[1]);t.push({value:e,text:i})}return t}},methods:{cleanRequestData(){"id"in this.chargeLogRequestData.filter.chargepoint&&(this.chargeLogRequestData.filter.chargepoint.id=this.chargeLogRequestData.filter.chargepoint.id.filter((e=>void 0!=e))),"chargemode"in this.chargeLogRequestData.filter.vehicle&&(this.chargeLogRequestData.filter.vehicle.chargemode=this.chargeLogRequestData.filter.vehicle.chargemode.filter((e=>void 0!=e))),"id"in this.chargeLogRequestData.filter.vehicle&&(this.chargeLogRequestData.filter.vehicle.id=this.chargeLogRequestData.filter.vehicle.id.filter((e=>void 0!=e)))},requestChargeLog(){let e=document.forms["chargeLogForm"];e.reportValidity()?(this.cleanRequestData(),this.$emit("sendCommand",{command:"getChargeLog",data:this.chargeLogRequestData})):console.log("form invalid")},makeTextFile(e){var t=new Blob([e],{type:"text/csv"});return null!==this.downloadFile&&window.URL.revokeObjectURL(this.downloadFile),this.downloadFile=window.URL.createObjectURL(t),this.downloadFile},downloadChargeLog(){this.$refs.downloadChargeLogLink.setAttribute("download","Ladeprotokoll-"+this.chargeLogDate+".csv"),this.$refs.downloadChargeLogLink.href=this.makeTextFile(this.chargeLogCsv),this.$refs.downloadChargeLogLink.dispatchEvent(new MouseEvent("click"))},alignEnd(e){return'<div class="td-end">'+e+"</div>"},alignCenter(e){return'<div class="td-center">'+e+"</div>"},translateBool(e,t=!0){let a="Nein",i="bg-danger";return e&&(a="Ja",i="bg-success"),t?'<div class="td-center tag '+i+'">'+a+"</div>":a},getChargeModeClass(e){switch(e){case"Sofort":return"bg-danger";case"PV":return"bg-success";case"Zielladen":return"bg-primary";case"Standby":return"bg-secondary";case"Stop":return"bg-dark";default:return console.warn("unknown charge mode:",e),"bg-light"}},translateHeading(e){switch(e){case"time_charged":return"Dauer";case"range_charged":return"Reichweite";case"imported_since_mode_switch":return"Energie im Lademodus";case"imported_since_plugged":return"Energie seit Anstecken";case"power":return"Leistung";case"costs":return"Kosten";default:return console.warn("unknown heading:",e),e}}},mounted(){const e=new Date;this.currentMonth=this.chargeLogDate=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0"),this.requestChargeLog()}};const Ae=(0,He.Z)(je,[["render",u],["__scopeId","data-v-55aa0fc1"]]);var Oe=Ae}}]);
//# sourceMappingURL=ChargeLog.ac90c60e.js.map